{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Launch Webpack Dev Server",
            "program": "./frontend/node_modules/.bin/webpack-dev-server",
            "request": "launch",
            "skipFiles": [
                "<node_internals>/**"
            ],
            "type": "node",
            "args": [
                "--config",
                "../frontend/webpack.config.js"
            ],
            "autoAttachChildProcesses": true,
            "stopOnEntry": true
        },
        //dlv attach --headless --listen=:2345 --api-version=2  $(pgrep bridge) bin/bridge 
        {
            "name": "Debug: Start and attach to the delve debugger",
            "type": "go",
            "request": "attach",
            "port": 2345,
            "host": "mac4mitch",
            "mode": "remote",
            "processId": "${input:dlvProgramProcessId}",
            "apiVersion": 2,
            "remotePath": "${workspaceFolder}",
            "cwd": "${workspaceFolder}"
        },
        {
            "name": "Attach to a Running Bridge Cluster Proxy Process",
            "type": "go",
            "request": "attach",
            "port": 2345,
            "host": "mac4mitch",
            "mode": "local",
            "processId": "${input:programProcessId}",
            "apiVersion": 2,
            "remotePath": "${workspaceFolder}",
            "cwd": "${workspaceFolder}"
        },
        {
            "name": "Debug: Launch a Bridge Cluster Proxy",
            "type": "go",
            "request": "launch",
            // "port": 2345,
            "apiVersion": 2,
            "mode": "debug",
            "cwd": "${workspaceFolder}",
            "program": "${workspaceFolder}/cmd/bridge/main.go",
            "env": {},
            "args": [
                "--base-address=http://mac4mitch:9000",
                "--ca-file=${workspaceFolder}/examples/ca.crt",
                "--k8s-auth=openshift",
                "--k8s-mode=off-cluster",
                "--k8s-mode-off-cluster-endpoint=https://api.gitops1.devcluster.openshift.com:6443",
                "--k8s-mode-off-cluster-skip-verify-tls=true",
                "--listen=http://127.0.0.1:9000",
                "--public-dir=${workspaceFolder}/frontend/public/dist",
                "--user-auth=openshift",
                "--user-auth-oidc-client-id=console-oauth-client",
                "--user-auth-oidc-client-secret-file=${workspaceFolder}/examples/console-client-secret",
                "--user-auth-oidc-ca-file=${workspaceFolder}/examples/ca.crt",
                "--k8s-mode-off-cluster-alertmanager=https://alertmanager-main-openshift-monitoring.apps.gitops1.devcluster.openshift.com",
                "--k8s-mode-off-cluster-thanos=https://thanos-querier-openshift-monitoring.apps.gitops1.devcluster.openshift.com",
            ]
        },
        {
            "name": "Launch and debug the Bridge Cluster Proxy",
            "type": "go",
            "request": "launch",
            //"port": 2345,
            "apiVersion": 2,
            "mode": "debug",
            "cwd": "${workspaceFolder}",
            "program": "${workspaceFolder}/cmd/bridge/main.go",
            "env": {},
            "args": [
                "--base-address=http://mac4mitch:9000",
                "--ca-file=${workspaceFolder}/examples/ca.crt",
                "--k8s-auth=openshift",
                "--k8s-mode=off-cluster",
                "--k8s-mode-off-cluster-endpoint=${input:clusterEndpoint}",
                "--k8s-mode-off-cluster-skip-verify-tls=true",
                "--listen=http://127.0.0.1:9000",
                "--public-dir=${workspaceFolder}/frontend/public/dist",
                "--user-auth=openshift",
                "--user-auth-oidc-client-id=console-oauth-client",
                "--user-auth-oidc-client-secret-file=${workspaceFolder}/examples/console-client-secret",
                "--user-auth-oidc-ca-file=${workspaceFolder}/examples/ca.crt",
                "--k8s-mode-off-cluster-alertmanager=${input:alertManagerEndpoint}",
                "--k8s-mode-off-cluster-thanos=${input:thanosEndpoint}",
            ]
        }
    ],
    "inputs": [
        {
            "type": "command",
            "id": "dlvProgramProcessId",
            "command": "shellCommand.execute",
            "args": {
                "command": "pgrep debug_bin",
                "cwd": "${workspaceFolder}",
            }
        },
        {
            "type": "command",
            "id": "programProcessId",
            "command": "shellCommand.execute",
            "args": {
                "command": "pgrep bridge",
                "cwd": "${workspaceFolder}",
            }
        },
        {
            "id": "clusterEndpoint",
            "type": "command",
            "command": "shellCommand.execute",
            "args": {
                "command": " oc whoami --show-server",
                "cwd": "${workspaceFolder}",
                "useFirstResult": true,
            }
        },
        {
            "id": "alertManagerEndpoint",
            "type": "command",
            "command": "shellCommand.execute",
            "args": {
                "command": "oc -n openshift-config-managed get configmap monitoring-shared-config -o jsonpath='{.data.alertmanagerPublicURL}'",
                "useFirstResult": true,
            }
        },
        {
            "id": "thanosEndpoint",
            "type": "command",
            "command": "shellCommand.execute",
            "args": {
                "command": "oc -n openshift-config-managed get configmap monitoring-shared-config -o jsonpath='{.data.thanosPublicURL}'",
                "useFirstResult": true,
            }
        }
    ]
}